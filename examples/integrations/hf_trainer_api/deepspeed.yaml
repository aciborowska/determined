name: vision transformer deepspeed stage 1
debug: false
environment:
    environment_variables:
        - NCCL_DEBUG=INFO
        # You may need to modify this to match your network configuration.
        - NCCL_SOCKET_IFNAME=ens,eth,ib
    image:
      gpu: determinedai/environments:cuda-11.3-pytorch-1.10-tf-2.8-deepspeed-0.7.0-gpu-9119094
resources:
  slots_per_trial: 4
searcher:
  name: single
  max_length: 3
  metric: eval_loss
entrypoint: >-
  python -m determined.launch.deepspeed
  python image_classification.py 
  --dataset_name beans  
  --output_dir ./beans_outputs/  
  --remove_unused_columns False 
  --do_train  
  --do_eval 
  --learning_rate 2e-5 
  --num_train_epochs 3 
  --per_device_train_batch_size 8 
  --per_device_eval_batch_size 8
  --logging_strategy steps 
  --logging_steps 10 
  --evaluation_strategy steps
  --eval_steps 10
  --save_total_limit 3 
  --seed 1337
  --save_strategy epoch
  --deepspeed ds_configs/ds_config_stage_1.json
max_restarts: 0
